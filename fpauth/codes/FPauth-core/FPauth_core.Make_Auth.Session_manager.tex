\subsection{Модуль \ocamlinlinecode{Make\_\allowbreak{}Auth.\allowbreak{}Session\_\allowbreak{}manager}}\label{page-FPauth-core-module-FPauth+u+core-module-Make+u+Auth-module-Session+u+manager}%
\ocamlinlinecode{SessionManager} - модуль, который устанавливает \ocamlinlinecode{fields} из сессии для каждого запроса через \hyperref[page-FPauth-core-module-FPauth+u+core-module-Auth+u+sign-module-type-SESSIONMANAGER-val-auth+u+setup]{\ocamlinlinecode{\ocamlinlinecode{Auth\_\allowbreak{}sign.\allowbreak{}SESSIONMANAGER.\allowbreak{}auth\_\allowbreak{}setup}}} middleware.

\label{page-FPauth-core-module-FPauth+u+core-module-Make+u+Auth-module-Session+u+manager-type-entity}\ocamlcodefragment{\ocamltag{keyword}{type} entity = \hyperref[page-FPauth-core-module-FPauth+u+core-module-Make+u+Auth-argument-1-M-type-t]{\ocamlinlinecode{M.\allowbreak{}t}}}\begin{ocamlindent}тип \ocamlinlinecode{entity} - тип аутентифицируемой сущности, совпадающий с \ocamlinlinecode{MODEL}.t\end{ocamlindent}%
\medbreak
\label{page-FPauth-core-module-FPauth+u+core-module-Make+u+Auth-module-Session+u+manager-val-auth+u+setup}\ocamlcodefragment{\ocamltag{keyword}{val} auth\_\allowbreak{}setup : \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}middleware}\begin{ocamlindent}\ocamlinlinecode{auth\_\allowbreak{}setup} - middleware, которое контролирует сессию, устанавливает переменные-\ocamlinlinecode{field} и всопмогательные функции для последующих handlers.\ocamlinlinecode{auth\_\allowbreak{}setup} пробует извлечь строку из сессии с ключом \ocamlinlinecode{auth} и определить статус аутентификации. Если поле \ocamlinlinecode{auth} отсутствует, то аутентификация не была пройдена. Если \ocamlinlinecode{auth} имеется, то по строке проверяется и изменяется статус аутентификации:\begin{itemize}\item{Если \ocamlinlinecode{auth} содержит пустую строку, то ситуация считается ошибочной;}%
\item{Если \hyperref[page-FPauth-core-module-FPauth+u+core-module-Make+u+Auth-argument-1-M-val-deserialize]{\ocamlinlinecode{\ocamlinlinecode{M.\allowbreak{}deserialize}}} вернула \ocamlinlinecode{Error Error.\allowbreak{}t}, то аутентификация не пройдена и ситуация считается ошибочной;}%
\item{Если \hyperref[page-FPauth-core-module-FPauth+u+core-module-Make+u+Auth-argument-1-M-val-deserialize]{\ocamlinlinecode{\ocamlinlinecode{M.\allowbreak{}deserialize}}} вернула \ocamlinlinecode{Ok M.\allowbreak{}t}, то аутентификация считается успешной и устанавливаются \ocamlinlinecode{VARIABLES}.current\_user и \ocamlinlinecode{VARIABLES}.authenticated. Если с сессией что-то не так, то сессия становится недействительной, ошибка записывается и статус 401 отправляется. Если сессия в порядке, то запрос поступает в следующий обработчик.}\end{itemize}%
\end{ocamlindent}%
\medbreak


