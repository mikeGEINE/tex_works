\subsection{Модуль \ocamlinlinecode{FPauth\_\allowbreak{}strategies.\allowbreak{}TOTP}}\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP}%
\ocamlinlinecode{TOTP} - стратегия проверки по одноразовым паролям на основе времени. Личность пользователя подтверждается паролем, действующим только в ограниченном временном промежутке.

Требуется \bold{параметр <<totp\_code>>}, иначе пропускется. Предоставляет следующие маршруты в области видимости "/totp":

\begin{itemize}\item{GET "/generate\_secret" является первым шагом для включения TOTP. Генерирует секрет для пользователя. Пользователь должен быть заранее аутентифицирован. Для пользователя стратегия не должна быть предварительно настроена.}%
\item{POST "/finish\_setup" является вторым шагом для включения TOTP. Должен получить "totp\_code" в качестве параметра, верифицирует его и включает TOTP в случае успешной верификации.}\end{itemize}%
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-val-name}\ocamlcodefragment{\ocamltag{keyword}{val} name : string}\begin{ocamlindent}Имя стратегии.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL}\ocamlcodefragment{\ocamltag{keyword}{module} \ocamltag{keyword}{type} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL]{\ocamlinlinecode{MODEL}}}\ocamlcodefragment{ = \ocamltag{keyword}{sig}}\begin{ocamlindent}\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t}\ocamlcodefragment{\ocamltag{keyword}{type} t}\\
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-val-otp+u+secret}\ocamlcodefragment{\ocamltag{keyword}{val} otp\_\allowbreak{}secret : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t]{\ocamlinlinecode{t}} \ocamltag{arrow}{$\rightarrow$} string}\begin{ocamlindent}Извлекает секрет TOTP для пользователся.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-val-otp+u+enabled}\ocamlcodefragment{\ocamltag{keyword}{val} otp\_\allowbreak{}enabled : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t]{\ocamlinlinecode{t}} \ocamltag{arrow}{$\rightarrow$} bool}\begin{ocamlindent}Проверяет, что TOTP уже настроена для пользователя. Возвращает: \ocamlinlinecode{true}, если пользователь может использовать TOTP.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-val-set+u+otp+u+secret}\ocamlcodefragment{\ocamltag{keyword}{val} set\_\allowbreak{}otp\_\allowbreak{}secret : \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}request \ocamltag{arrow}{$\rightarrow$} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t]{\ocamlinlinecode{t}} \ocamltag{arrow}{$\rightarrow$} string \ocamltag{arrow}{$\rightarrow$} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t]{\ocamlinlinecode{t}} \hyperref[xref-unresolved]{\ocamlinlinecode{Lwt}}.\allowbreak{}t}\begin{ocamlindent}Устанавливает TOTP секрет во время настройки. Возвращает обновлённого пользователя.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-val-set+u+otp+u+enabled}\ocamlcodefragment{\ocamltag{keyword}{val} set\_\allowbreak{}otp\_\allowbreak{}enabled : \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}request \ocamltag{arrow}{$\rightarrow$} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t]{\ocamlinlinecode{t}} \ocamltag{arrow}{$\rightarrow$} bool \ocamltag{arrow}{$\rightarrow$} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL-type-t]{\ocamlinlinecode{t}} \hyperref[xref-unresolved]{\ocamlinlinecode{Lwt}}.\allowbreak{}t}\begin{ocamlindent}Включает TOTP. Возвращает обновлённого пользователя.\end{ocamlindent}%
\medbreak
\end{ocamlindent}%
\ocamlcodefragment{\ocamltag{keyword}{end}}\begin{ocamlindent}\ocamlinlinecode{MODEL} содержит требования к модели пользователя для того, чтобы использовать стратегию.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES}\ocamlcodefragment{\ocamltag{keyword}{module} \ocamltag{keyword}{type} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES]{\ocamlinlinecode{RESPONSES}}}\ocamlcodefragment{ = \ocamltag{keyword}{sig}}\begin{ocamlindent}\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES-val-response+u+error}\ocamlcodefragment{\ocamltag{keyword}{val} response\_\allowbreak{}error : \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}request \ocamltag{arrow}{$\rightarrow$} \hyperref[xref-unresolved]{\ocamlinlinecode{Base}}.\allowbreak{}Error.\allowbreak{}t \ocamltag{arrow}{$\rightarrow$} \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}response \hyperref[xref-unresolved]{\ocamlinlinecode{Lwt}}.\allowbreak{}t}\begin{ocamlindent}Этот шаблон используется для демонстрации различных ошибок.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES-val-response+u+secret}\ocamlcodefragment{\ocamltag{keyword}{val} response\_\allowbreak{}secret : \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}request \ocamltag{arrow}{$\rightarrow$} string \ocamltag{arrow}{$\rightarrow$} \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}response \hyperref[xref-unresolved]{\ocamlinlinecode{Lwt}}.\allowbreak{}t}\begin{ocamlindent}Этот ответ используется во время настройки TOTP. В рамках этого шага пользователям предоставляется секрет, который им необъодимо занести в их генератор OTP.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES-val-response+u+enabled}\ocamlcodefragment{\ocamltag{keyword}{val} response\_\allowbreak{}enabled : \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}request \ocamltag{arrow}{$\rightarrow$} \hyperref[xref-unresolved]{\ocamlinlinecode{Dream}}.\allowbreak{}response \hyperref[xref-unresolved]{\ocamlinlinecode{Lwt}}.\allowbreak{}t}\begin{ocamlindent}Этот ответ информирует пользователя об успешном включении TOTP.\end{ocamlindent}%
\medbreak
\end{ocamlindent}%
\ocamlcodefragment{\ocamltag{keyword}{end}}\begin{ocamlindent}\ocamlinlinecode{RESPONSES} содержит представления данных для определённых событий.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make}\ocamlcodefragment{\ocamltag{keyword}{module} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make]{\ocamlinlinecode{Make}}}\ocamlcodefragment{
  (\hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make-argument-1-R]{\ocamlinlinecode{R}} : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES]{\ocamlinlinecode{RESPONSES}})
  (\hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make-argument-2-M]{\ocamlinlinecode{M}} : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-MODEL]{\ocamlinlinecode{MODEL}})
  (\hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make-argument-3-V]{\ocamlinlinecode{V}} : \hyperref[page-FPauth-core-module-FPauth+u+core-module-Auth+u+sign-module-type-VARIABLES]{\ocamlinlinecode{FPauth\_\allowbreak{}core.\allowbreak{}Auth\_\allowbreak{}sign.\allowbreak{}VARIABLES}} \ocamltag{keyword}{with} \ocamltag{keyword}{type} \hyperref[page-FPauth-core-module-FPauth+u+core-module-Auth+u+sign-module-type-VARIABLES-type-entity]{\ocamlinlinecode{entity}} = \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make-argument-2-M-type-t]{\ocamlinlinecode{M.\allowbreak{}t}}) : 
  \ocamltag{keyword}{sig} .\allowbreak{}.\allowbreak{}.\allowbreak{} \ocamltag{keyword}{end}}\begin{ocamlindent}\ocamlinlinecode{Make} создаёт стратегию для предоставленной модели с предоставленными ответами.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-JSON+u+Responses}\ocamlcodefragment{\ocamltag{keyword}{module} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-JSON+u+Responses]{\ocamlinlinecode{JSON\_\allowbreak{}Responses}}}\ocamlcodefragment{ : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES]{\ocamlinlinecode{RESPONSES}}}\begin{ocamlindent}Модуль с ответами для TOTP в формате JSON.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-HTML+u+settings}\ocamlcodefragment{\ocamltag{keyword}{module} \ocamltag{keyword}{type} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-HTML+u+settings]{\ocamlinlinecode{HTML\_\allowbreak{}settings}}}\ocamlcodefragment{ = \ocamltag{keyword}{sig}}\begin{ocamlindent}\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-HTML+u+settings-val-app+u+name}\ocamlcodefragment{\ocamltag{keyword}{val} app\_\allowbreak{}name : string}\\
\end{ocamlindent}%
\ocamlcodefragment{\ocamltag{keyword}{end}}\begin{ocamlindent}Этот модуль должен содержать такие настройки, как имя приложения для заголовков.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make+u+HTML+u+Responses}\ocamlcodefragment{\ocamltag{keyword}{module} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make+u+HTML+u+Responses]{\ocamlinlinecode{Make\_\allowbreak{}HTML\_\allowbreak{}Responses}}}\ocamlcodefragment{ (\hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-Make+u+HTML+u+Responses-argument-1-S]{\ocamlinlinecode{S}} : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-HTML+u+settings]{\ocamlinlinecode{HTML\_\allowbreak{}settings}}) : \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES]{\ocamlinlinecode{RESPONSES}}}\begin{ocamlindent}Этот функтор создаёт модуль, соответствующий \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES]{\ocamlinlinecode{\ocamlinlinecode{RESPONSES}}}, в формате HTML.\end{ocamlindent}%
\medbreak
\label{page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-val-make+u+html+u+responses}\ocamlcodefragment{\ocamltag{keyword}{val} make\_\allowbreak{}html\_\allowbreak{}responses : ?app\_\allowbreak{}name:string \ocamltag{arrow}{$\rightarrow$} unit \ocamltag{arrow}{$\rightarrow$} (\ocamltag{keyword}{module} \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-RESPONSES]{\ocamlinlinecode{RESPONSES}})}\begin{ocamlindent}\ocamlinlinecode{make\_\allowbreak{}html\_\allowbreak{}responses \textasciitilde{}app\_\allowbreak{}name ()} - функция для удобного создания модуля HTML ответов без \hyperref[page-FPauth-strategies-module-FPauth+u+strategies-module-TOTP-module-type-HTML+u+settings]{\ocamlinlinecode{\ocamlinlinecode{HTML\_\allowbreak{}settings}}}. Возвращает модуль первого класса.\end{ocamlindent}%
\medbreak

% \input{FPauth-strategies/FPauth_strategies.TOTP.Make.tex}
% \input{FPauth-strategies/FPauth_strategies.TOTP.JSON_Responses.tex}
% \input{FPauth-strategies/FPauth_strategies.TOTP.Make_HTML_Responses.tex}
