% !TEX program = xelatex

\documentclass[a4paper, 14pt]{extarticle}
\usepackage{bmstu-lab}
\hypersetup{
    linkcolor=black
}

\begin{document}
    \graphicspath{{images/}{images2/}} % папки с картинками
    \renewcommand{\figurename}{Рисунок}

    \worknumber{2}
    \variant{4}
    \workname{Проектирование цифровых устройств на основе ПЛИС}
    \discipline{Основы проектирования устройств ЭВМ}
    \group{ИУ6-64Б}
    \author{М.А.Гейне}
    \tutor[Преподаватель]{А.Ю.Попов}
    \bmstutitlelab

    \textbf{Цель работы:} 
    закрепление на практике теоретических сведений, полученных приизучении   методики   проектирования   цифровых   устройств   на   основе   программируемыхлогических интегральных схем (ПЛИС), получение необходимых навыков работы с системойавтоматизированного проектирования  ISEWebPack  устройств на основе ПЛИС фирмы Xilinx, изучение аппаратных и программных средств моделирования, макетирования иотладки устройств на основе ПЛИС.

    \section*{Задание}
    В ходе выполнения лабораторной работы выполнить проектирование счётчика нажатий на кнопку, следуя заданиям:
    \begin{enumerate}
        \item Выполнить   кодирование   состояний   автомата в соответствии с индивидуальным вариантом;
        \item Разработать текстовое описание модуля в соответствии с полученнымифункциями DLY\_EN, CNT, SN(0), SN(1) на основе шаблона;
        \item В интегрированном редакторе тестов САПР Xilinx ISE разработать тестдля полученного устройства и выполнить моделирование его работы в симуляторе Modelsim;
        \item Разработать   устройство   управления,   принимающее   16-разрядноеинформационное слово  Q[0..15] и управляющее их последовательной выдачей по шинеD[0..3] на декодер 7-сегментных индикаторов;
        \item Разработать   поведенческое  VHDL  описание   схемы   преобразованиячетырехразрядного   информационного   кода  D[0..3]   в   код   активизации   7-сегментногоиндикатора LED[0..7];
        \item В редакторе схем САПР ISE добавить исходное описание, заменить   пропущенные   сигналы;
        \item  В программе XilinxPACE создать файл ограничений *.ucf  или добавьте впроект имеющийся main\_xc3s200.ucf;
        \item  В САПР ISE выполнить автоматический синтез технологической схемы,размещение и трассировку  полученного устройства на кристалле  Spartan3 XC3S200 ft256, cгенерировать файл конфигурации ПЛИС (*.bin);
        \item Выполнить программирование макетной ПЛИС  Spartan3 отладочногонабора XC3S200.
    \end{enumerate}
    \section*{Индивидуальный вариант}
    \begin{table}[H]
        \begin{center}
            \begin{tabular}{|c|c|c|c|c|c|}
                \hline
                \multirow{2}{*}{Вариант} & \multirow{2}{*}{Набор} & \multicolumn{4}{|c|}{Двоичный код состояния S(1), S(0) } \\
                \cline{3-6}
                & &State0 &State1 &State2 &State3 \\
                \hline
                4 & XC3S200 & 00& 10 & 11 & 01 \\
                \hline
            \end{tabular}
        \end{center}
    \end{table}
    \pagebreak

    \section{Кодирование автомата}
    Выполнение лабораторной работы начинается с проектирования схемы подавления дребезга кнопки.
    При нажатии и отжатии кнопка на плате дребезжит, из-за чего можно наблюдать лишние срабатывания устройства.
    Для подавления дребезга необходимо после нажатия кнопки подождать небольшой интервал времени, в течение которого состояние кнопки будет игнорироваться.
    То же самое необходимо произвести и после отжатия кнопки. Пока кнопка зажата, система должна выдавать соответствующий сигнал.
    Систему подавления дребезга можно реализовать в виде конечного автомата, диаграмма состояний которого приведена на рисунке \ref{fig:states}.
    \imageinsert{states.png}{0.75}{Диаграмма состояния автомата подавления дребезга}{fig:states}

    В соответствии с индивидуальным вариантом была составлена таблица выходов автомата, зависящих от состояния.
    Таблица приведена на рисунке \ref{fig:output_table}.
    \imageinsert{output_table}{0.25}{Таблица выходов}{fig:output_table}

    На основе данной таблицы были составлены функции следующих сигналов: $CNT=S1$ и $DLY\_EN=S1\bigoplus S0$.

    Далее была составлена таблица переходов состояний автомата, приведённая на рисунке \ref{fig:transitions_table}.
    \imageinsert{transitions_table}{0.25}{Таблица переходов состояний автомата}{fig:transitions_table}

    На основе данной таблицы были составлены функции следующих управляющих сигналов: $SN(1)=S(1)\overline{S(0)}\bigvee CS(1) \bigvee С\overline{S(0)}$ и $SN(0)=S(1)S(0) \bigvee DS(1) \bigvee \overline{D}S(0)$.

    \section{Текстовое описание автомата}
    После того, как были выведены необходимые логические функции, было создано текстовое описание модуля на языке VHDL. Текст модуля приведён ниже.
    \codeinsert{'codes/delay_module.vhd'}

    \section{Тестирование автомата}
    Для созданного автомата был разработан testbench средствами ISE.
    Временная диаграмма тестирования приведена на рисунке \ref{fig:delay_module_test}.
    \imageinsert{delay_test.png}{0.62}{Временная диаграмма теста автомата}{fig:delay_module_test}
    Как видно на временной диаграмме, на входе автомата сигнал clk имеет несколько фронтов и спадов в малом временном промежутке, что симулирует дребезг кнопки.
    На выходе автомата cnt дребезг отсутствует, сигнал стабильный.

    \section{Разработка устройства управления индикаторами}
    Задача данного устройства состоит в том, чтобы вывести на 4 семи-сегментных индикатора платы текущее значение счётчика.
    В счётчике хранится двоичное число, тетрады которого возможно представить в виде шестнадцатиричных чисел. Всего в счётчике четыре тетрады. Схема управления последовательно выделяет тетрады и подаёт их на свой выход.
    Кроме того, необходимо обеспечить едновременное включение всех 4 индикаторов. Для этого на каждый из индикаторов последовательно выводится код очередной цифры, переключение текущего индикатора производится с большой скоростью.
    
    Таким образом, схема управления производит выбор индикатора, на который производится вывод, и выбор тетрады из счётчика для вывода на индикатор. Код устройства приведён ниже.
    \codeinsert{'codes/sevenseg_mux.vhd'}

    Для проверки правильности работы устройства был разработан testbench, временная диагрмма с которого приведена на рисунке \ref{fig:sevenseg_mux_test}.
    \imageinsert{led_test.png}{0.62}{Временная диаграмма теста устройства управления}{fig:sevenseg_mux_test}

    \section{Схема преобразования кода цифры в код индикатора}
    На семисегментный индикатор должен приходить не четырёхразрядный код некоторой цифры, а восьмиразрядный код, определяющий включенные сегменты индикатора.
    Для этого необходимо разработать преобразователь, который получив на входе 4 разряда цифры выдаст 8 разрядов кода активации индикатора.
    Такой преобразователь представляет из себя, по сути, Look-Up Table.
    Текст описания устройства приведён ниже.
    \codeinsert{'codes/sevenseg_decoder.vhd'}

    \section{Разработка основного модуля проекта}
    Основной модуль проекта является устройством верхнего уровня, который и будет считать нажатия на кнопку.
    Основной модуль включает в себя разработанные ранее модули, а также 16-разрядный счётчик нажатий и делитель частоты для корректной работы схемы управления индикаторами.
    Код разработанного основного модуля приведён ниже.
    \codeinsert{'codes/main_ex.vhd'}

    Для проверки корректности работы устройства был разработан testbench, временная диаграмма работы которого приведена на рисунке \ref{fig:main_test}.
    \imageinsert{main_test.png}{0.85}{Временная диаграмма теста основного модуля}{fig:main_test}

    \section{Файл ограничений}
    В проект был добавлен файл ограничений, в котором были назначены внешние выводы сигналам разрабатываемого устройства в соответствии с заданными в методических указаниях для платы XC3S200.
    Код файла ограничений приведён ниже.
    \codeinsert{'codes/main_xc3s200.ucf'}

    \section{Синтез схемы}
    В САПР ISE был проведён синтез полученного устройства. Сведения о результатах проектирования устройства отображены на рисунке \ref{fig:synthesis_res}. 
    \imageinsert{design_report.png}{0.57}{Результаты проектирования}{fig:synthesis_res}

    В этом отчёте можно полоучить информацию о количестве элементов, используемых при синтезе:
    задействовано 42 LUT, 87 Slice Flip Flops.

    Также ISE генерирует отчёт о таймингах, который приведён на рисунке \ref{fig:timing_report}.
    \imageinsert{timing_report.png}{1}{Отчёт о быстродействии}{fig:timing_report}
    Из отчёта становится известно, что на распространение CLK до портов устройства требуется не больше 14ns. От нажатия на клавишу подсчёта до clk пройдёт не более 1.2ns, а в случае сброса - не более 4.2ns. Сигнал нужно при этом задерживать менее 1ns.

    \pagebreak
    \section*{Выводы}
    Изучено явление дребезга кнопки и методы фильтрации дребезга.
    
    Изучены основы проектирования на языке VHDL.

    Спроектировано устройство подавления дребезга кнопки.

    Спроектирована схема управления 4 семисегментными индикаторами.

    Спроектировано устройство преобразования четырёхразрядного кода цифры в восьмиразрядный код активации индикатора.

    Спроектировано основное устройство, включающее в себя разработанные ранее устройства, а также счётчик и делитель частоты.

    Составлен файл ограничений с назначением внутренних сигналов внешним выводам платы.

    Произведено тестирование разработанных устройств с использованием Testbench Waveform.
    
    Произведён синтез разработанного устройства. Проведены оценки быстродействия.

    Произведена прошивка платы, проведено ручное тестирование устройства.

\end{document}